<div class="container mt-3"> 
  <h3 class="page-title text-center mb-4">Réservation d'Appartement</h3>

  <!-- Step 1: Select Pays -->
<div class="form-row mb-3">
  <label class="form-label">Choisir un Pays</label>
  <select class="form-select" [(ngModel)]="selectedPaysId" (change)="onPaysChange()">
    <option [ngValue]="undefined" disabled>-- Sélectionner un pays --</option>
    <option *ngFor="let pays of paysList" [value]="pays.id_country">{{ pays.pays }}</option>
  </select>
</div>


  <!-- Step 2: Select Residence -->
  <div class="form-row mb-3" *ngIf="residencesList.length > 0">
    <label class="form-label">Choisir une Résidence</label>
    <select class="form-select" [(ngModel)]="selectedResidenceId" (change)="onResidenceChange()">
      <option [ngValue]="undefined" disabled>-- Sélectionner une résidence --</option>
      <option *ngFor="let res of residencesList" [value]="res.id_residence">{{ res.nom }}</option>
    </select>
  </div>

  <!-- Step 3: Select Bloc -->
  <div class="form-row mb-3" *ngIf="blocsList.length > 0">
    <label class="form-label">Choisir un Bloc</label>
    <select class="form-select" [(ngModel)]="selectedBlocId" (change)="onBlocChange()">
      <option [ngValue]="undefined" disabled>-- Sélectionner un bloc --</option>
      <option *ngFor="let bloc of blocsList" [value]="bloc.id_bloc">{{ bloc.nom }}</option>
    </select>
  </div>

<!-- Step 4: Select Appartement -->
<div *ngIf="appartementsList.length > 0" class="mt-4">
   
 



 



<div class="row apartments-section">
  <div class="col-lg-4 col-md-6 mb-4" *ngFor="let app of appartementsList">  
    <div class="card h-100 custom-card">
      <img [src]="app.image ? '/assets/' + app.image : '/assets/images/app1.png'" 
           class="card-img-top" 
           alt="{{ app.titre }}">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title">{{ app.titre }}</h5>
        <p class="card-text">{{ app.description || 'No description available' }}</p>
        <button *ngIf="!reservedApartments.includes(app.id_app!)"
        class="btn btn-success mt-auto" 
        (click)="openReservationModal(app)">
          Réserver
        </button>

        <span *ngIf="reservedApartments.includes(app.id_app!)" class="text-muted mt-auto">Déjà réservé</span>

      </div>
    </div>
  </div>
</div>



  <!-- Toasts -->
  <div class="toast-container position-fixed top-0 end-0 p-3">
    <div *ngFor="let toast of toasts" class="toast show" [ngClass]="toast.type">
      {{ toast.message }}
    </div>
  </div>
</div>









<!-- Reservation Modal -->
<div class="modal fade" id="reservationModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog"  style="margin-top: 250px;">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Réserver Appartement</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" *ngIf="selectedAppartement">
        <p>Appartement: <strong>{{ selectedAppartement.titre }}</strong></p>
        <form>
          <div class="mb-3">
            <label class="form-label">Date de début</label>
            <input type="date" class="form-control" [(ngModel)]="reservation.dateDebut" name="dateDebut" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Date de fin</label>
            <input type="date" class="form-control" [(ngModel)]="reservation.dateFin" name="dateFin" required />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
        <button type="button" class="btn btn-primary" (click)="confirmReservation()">Réserver</button>
      </div>
    </div>
  </div>
</div>
